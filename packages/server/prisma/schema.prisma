generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         Int                         @id @default(autoincrement())
  vkId                       String                      @unique
  vkData                     Json?
  createdAt                  DateTime                    @default(now()) @db.Timestamptz(3)
  translations               Translation[]
  stacks                     Stack[]
  stacksTranslations         TranslationInStack[]
  userTranslationRepetitions UserTranslationRepetition[]
  selectedLanguageId         Int?
  selectedLanguage           Language?                   @relation(fields: [selectedLanguageId], references: [id])
}

model Translation {
  id                         Int                         @id @default(autoincrement())
  authorId                   Int
  vernacular                 String
  foreign                    String
  stacks                     TranslationInStack[]
  userTranslationRepetitions UserTranslationRepetition[]
  languageId                 Int

  tags     Tag[]
  author   User     @relation(fields: [authorId], references: [id])
  language Language @relation(fields: [languageId], references: [id])
}

model Stack {
  id           Int                  @id @default(autoincrement())
  authorId     Int
  translations TranslationInStack[]
  tagsId       Int[]

  author User @relation(fields: [authorId], references: [id])
}

model TranslationInStack {
  translationId Int
  stackId       Int
  addedBy       Int
  addedAt       DateTime @default(now())

  translation Translation @relation(fields: [translationId], references: [id])
  stack       Stack       @relation(fields: [stackId], references: [id])
  addedByUser User        @relation(fields: [addedBy], references: [id])

  @@id([translationId, stackId])
}

model Language {
  id           Int                 @id @default(autoincrement())
  name         String
  iconUrl      String
  variations   LanguageVariation[]
  users        User[]
  translations Translation[]
}

model LanguageVariation {
  id         Int    @id @default(autoincrement())
  languageId Int
  name       String
  iconUrl    String

  language Language @relation(fields: [languageId], references: [id])
}

model Tag {
  id           Int           @id @default(autoincrement())
  name         String
  translations Translation[]
}

model UserTranslationRepetition {
  userId        Int
  translationId Int
  repeatedAt    DateTime @default(now())

  user        User        @relation(fields: [userId], references: [id])
  translation Translation @relation(fields: [translationId], references: [id])

  @@id([userId, translationId, repeatedAt])
}
